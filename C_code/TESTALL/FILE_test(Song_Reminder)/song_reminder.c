#include<stdio.h>
#include<stdlib.h>
#include<string.h>
#include<windows.h>
int main() {
    SetConsoleOutputCP(65001); // è®¾ç½®æ§åˆ¶å°ç¼–ç ä¸º UTF-8
    FILE *fp;
    fp=fopen("../../filetest.txt","w+");//w+ä¸ºè¯»å†™ï¼Œå¯ä»¥è®©å†™çš„ä¸œè¥¿è¦†ç›–åŸæœ‰æ–‡ä»¶å†…å®¹
    if(fp==NULL){
        printf("æ–‡ä»¶æ‰“å¼€å¤±è´¥\n");
        return 1;
    }
    char buffer[60];
    char b[]={"We are ä¼æœ¨ç´¯ï¼ï¼ï¼"};
    char a[][60]={"gogogo,å‡ºå‘å’¯",
        "é»‘å’–å•¡å“å‘³æœ‰å¤šæµ“","æˆ‘åªè¦æ±½æ°´å’Œè½»æ¾",
        "å¤§çƒ­å¤©åšä¸ªç™½æ—¥æ¢¦","æ¢¦è§æˆ‘å˜æˆäº†å½©è™¹",
        "æˆ‘æœ‰æƒ³å¥”è·‘çš„å†²åŠ¨","æœ‰ä½ åœ¨è·Œå€’ä¹Ÿä»å®¹",
        "æ— æ‰€ç•æƒ§çš„å»è¿½æ¢¦","æ±—æ°´ä¹¦å†™è¿™ä»½å…‰è£",
        "ç”µå½±ä¸­è§’è‰²ä¹Ÿä¼šæœ‰ä¸åŒ","æ¯ä¸€ä¸ªå°äººç‰©ä¹Ÿæ‹¥æœ‰å°çš„æ¢¦",
        "å¤§å±å¹•æ˜ ä¸å‡ºç°å®ä¸­çš„æš—æ¶Œ","æˆ‘åªæƒ³å’Œä½ ç‰µç€æ‰‹åœ¨é›¨ä¸­ç­‰å½©è™¹",
        "ä½ è¯´æˆ‘æ˜¯ä½ çš„è¶…çº§è‹±é›„","å¶å°”ä¹Ÿå®¢ä¸²ä½ çš„å‡ºæ°”ç­’",
        "å¿ƒç”˜æƒ…æ„¿æ¥å—è¿™ä»½å…‰è£~","åšä½ èº«è¾¹çš„è¤ç«è™«oh~a~ei",
        "å¦‚æœæˆ‘æ˜¯ä½ çš„è¶…çº§è‹±é›„","æ­¤åˆ»ä¸ºä½ é«˜å”±è¿™é¦–Love-song~~",
        "å°å°çš„é»˜å¥‘è®©çˆ±è½¬åŠ¨","åšä½ æœ€éª„å‚²çš„è‹±é›„"};


    //fgetc/fputc
    int ch=78;
    fputc(ch,fp);  //fputc
    rewind(fp); // ç¡®ä¿æŒ‡é’ˆåœ¨å¼€å¤´
    printf("fputc/fgetcæ–¹å¼ï¼š\n");
    printf("%c\n",fgetc(fp));
    printf("----------------------------\n");
    printf("\n");

    //fgets/fputs
    rewind(fp);
    fputs(b,fp);
    rewind(fp);
    printf("fgets/fputsæ–¹å¼:\n");
    fgets(buffer,60,fp);

    printf("%s\n",buffer);
    printf("----------------------------\n");
    printf("\n");
    if(feof(fp))
    {
        printf("åŸºç¡€è¾“å‡ºç»“æŸï¼Œå¼€å§‹æ•´æ´»ï¼ï¼\n");//åˆ¤æ–­æ–‡ä»¶æ˜¯å¦åˆ°ç»“æŸ
    }
    else{
        printf("å‰è¾¹æœ‰é”™è¯¯\n");
        return 1;
    }
    rewind(fp);//å¤ä½åˆ°æ–‡ä»¶å¼€å¤´

    printf("----------------------------\n");
    printf("\n");

    //fprintf/fscanf
    int len=sizeof(a)/sizeof(a[0]);
    for(int i=0;i<len;i++)
    {
        fprintf(fp,"%s",a[i]);
        fputs("\n", fp); // æ·»åŠ æ¢è¡Œç¬¦
    }

    rewind(fp);//
    printf("fprintf/fscanfæ–¹å¼ï¼š\n   ã€Šè¶…çº§è‹±é›„ã€‹\n    åŸå”±:é‚“è¶…\n");
    for(int i=0;i<len;i++){
    fscanf(fp,"%s",buffer);
    printf("%d : %s\n",i+1,buffer);
    memset(buffer,0,sizeof(buffer));
    Sleep(3000);
}
    long offset=ftell(fp);
    fclose(fp);

    printf("é—´å¥ä¸­~~~~~~~~~~\n");
    Sleep(1000);
    printf("ğŸ¶");
    Sleep(1000);
    printf("ğŸ¶");
    Sleep(1000);
    printf("ğŸ¶");
    Sleep(1000);
    printf("ğŸ¶");
    Sleep(1000);
    printf("ğŸ¶");
    Sleep(1000);
    printf("ğŸ¶");
    Sleep(1000);
    printf("ğŸ¶\n");
    //ç¬¬äºŒæ®µè¿½åŠ å†…å®¹
    FILE *fp2;
    fp2=fopen("../../filetest.txt","r+");
    //è¿™é‡Œç”¨a+ä¼šè¿½åŠ ï¼Œä½†æ˜¯ç”¨fseekå›åˆ°ä½ç½®ä¼šå‡ºé”™ï¼Œå› ä¸ºfseekä¼šåœ¨aæ— æ•ˆï¼Œå¤§æ¦‚å¯èƒ½æ˜¯å› ä¸ºa+æœ¬èº«å°±æœ‰å¼ºåˆ¶é‡å®šä½ï¼ˆè‡ªåŠ¨åˆ°å°¾éƒ¨ï¼‰
    if(fp2==NULL){
        printf("æ–‡ä»¶æ‰“å¼€é”™è¯¯\n");
        return 1;
    }
    char c[][60]={"æˆ‘æœ‰æƒ³å¥”è·‘çš„å†²åŠ¨","æœ‰ä½ åœ¨è·Œå€’ä¹Ÿä»å®¹",
                  "æ— æ‰€ç•æƒ§çš„å»è¿½æ¢¦","æ±—æ°´ä¹¦å†™è¿™ä»½å…‰è£",
                  "ä¸ç®¡ä½åŸå ¡æˆ–èƒ¡åŒ","ä¹Ÿä¸ç®¡å¯Œæœ‰æˆ–è´«ç©·",
                  "å› ä¸ºæœ‰çˆ±ä¸åœè½¬åŠ¨","é‡‘å±±ä¹Ÿä¸åœ¨æˆ‘çœ¼ä¸­",
                  "ç”µå½±ä¸­è§’è‰²ä¹Ÿä¼šæœ‰ä¸åŒ","æ¯ä¸€ä¸ªå°äººç‰©ä¹Ÿæ‹¥æœ‰å°çš„æ¢¦",
                  "å¤§å±å¹•æ˜ ä¸å‡ºç°å®ä¸­çš„æš—æ¶Œ","æˆ‘åªæƒ³å’Œä½ ç‰µç€æ‰‹åœ¨é›¨ä¸­ç­‰å½©è™¹",
                  "ä½ è¯´æˆ‘æ˜¯ä½ çš„è¶…çº§è‹±é›„!","å¶å°”ä¹Ÿå®¢ä¸²ä½ çš„å‡ºæ°”ç­’~",
                  "å¿ƒç”˜æƒ…æ„¿æ¥å—è¿™ä»½å…‰è£","åšä½ èº«è¾¹çš„è¤ç«è™«oh~a~ei",
                  "å¦‚æœæˆ‘æ˜¯ä½ çš„è¶…çº§è‹±é›„!!!","æ­¤åˆ»ä¸ºä½ é«˜å”±è¿™é¦–Love-song~~",
                  "å°å°çš„é»˜å¥‘è®©çˆ±è½¬åŠ¨","åšä½ æœ€éª„å‚²çš„è‹±é›„",
                  "æˆ‘æ˜¯ä½ éª„å‚²çš„è‹±é›„~~~"};
    int len2=sizeof(c)/sizeof(c[0]);//ç¬¬äºŒæ®µå†…å®¹é•¿åº¦
    char buffer2[len2][60];

    if (fseek(fp2, offset, SEEK_SET) != 0) //fseekä½¿ç”¨ï¼Œå®šä½åˆ°ä¸Šæ¬¡æ–‡ä»¶ä½ç½®ï¼Œå¹¶ä¸”å¦‚æœæ²¡æˆåŠŸåˆ™è¿›å…¥if
    {
    perror("fseek å¤±è´¥");
    fclose(fp2);
    return 1;
    }

    for(int i=0;i<len2;i++){
    fwrite(c[i],1,60,fp2);//fwriteè¯»å…¥æ–‡ä»¶ï¼Œæ¯æ¬¡60å­—ç¬¦ï¼Œä¸€ä¸ªå­—ç¬¦1Byte,ä½†æ˜¯è¿™ç§è¯»å…¥æ–¹å¼ä¼šè®©æ–‡ä»¶çš„æ ¼å¼å˜ä¹±
    //fputs("\n",fp2);    //å¦‚æœé‡‡ç”¨ä¸Šè¾¹åŒæ ·çš„è¯»å…¥å›è½¦fputs("\n",fp2);é‚£ä¹ˆä¸‹é¢å°±ä¼šå‡ºç°é—®é¢˜ï¼Œä¸‹è¾¹ä¼šè¯´åˆ°.
    }                     

    fflush(fp2);//å†™å…¥åï¼Œfflushç¡®ä¿å†™å…¥ç£ç›˜
  
    fseek(fp2,offset,SEEK_SET);  //å†™å…¥å®Œï¼Œæ–‡ä»¶æ¥åˆ°äº†æœ€æœ«å°¾ï¼Œé‡æ–°å®šä½åˆ°ç¬¬ä¸€æ®µç»“æŸï¼Œå³ç¬¬äºŒæ®µå¼€å§‹
    printf("ç¬¬äºŒæ®µ\n");
    for(int i=0;i<len2;i++)
    {
        fread(buffer2[i],1,60,fp2);/*å¦‚æœä¸Šæ–¹ä½¿ç”¨å›è½¦ï¼Œæ–‡æœ¬ä¸­çš„å†…å®¹æ ¼å¼ä¸Šç¡®å®ä¼šå·¥æ•´ï¼Œä½†æ˜¯åœ¨freadç¯èŠ‚ï¼Œ
                                     freadä¸ä¼šå¯¹æ¢è¡Œç¬¦è¿›è¡Œè¯†åˆ«ï¼Œä¼šå½“ä½œå†…å®¹ï¼Œè¿™ä¹Ÿå¯¼è‡´æ­¤å¤„çš„è·å–å¾ˆå¤§å¯èƒ½å˜æˆç©ºï¼Œ
                                     æˆ–è€…ä¹Ÿå¯ä»¥ä½¿ç”¨fgetsæ¥è·å–ï¼Œä¸è¿‡é‚£æ ·çš„è¯ä¸€å¼€å§‹ä½¿ç”¨fgetså’Œfputsä¼šæ›´å¥½*/
    }

    for(int i=0;i<len2;i++)
    {
        Sleep(3000);
        printf("%d : %s\n",i+len+1,buffer2[i]);
    }
    fclose(fp2);
    return 0;
}
